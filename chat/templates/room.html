{% extends 'base.html' %}

{% load static %}
{% load q_tags %}

{% block title %}
  django-channels-chat
{% endblock title %}

{% block style %}
<style>
  #onlineUsersSelector {
    height: 300px;
  }

  .message {
    display: flex;
    flex-direction: column;
    width: 600px;
  }

  .message_user {
    flex: 1;
    width: 50px;
    height: 50px;
  }

  .message_text {
    flex: 3;
  }
</style>
{% endblock style %} {% block content %}
<div class="container mt-3 p-5">
  <h2>django-channels-chat</h2>

  {% comment %} TODO: вынести аккаунт в navbar {% endcomment %}
  <figure>
    <img src="http://{{ req.get_host }}/media/{{ path }}" width="150" height="150" />
    <figcaption id="username">{{ username }}</figcaption>
  </figure>
  <a href="{% url 'chat:logout' %}">Logout</a>

  <div class="row">
    <div class="col-12 col-md-8">
      <div class="mb-2">
        <label for="chatLog">Room: #{{ room.name }}</label>
        {% comment %} TODO: Заменить textarea на div {% endcomment %}
        <div id="chatLog">
          {% comment %} <img src="#" alt="" id="q" width="150" height="150"> {% endcomment %}
          {% for message in messages %}
            <div>
              <div>
                <img src="{{ message.user.avatar.photo.url }}" width="40" height="40">
                <div>{{ message.user.username }}:</div>
              </div>

              <div>
                <img src={{ message | get_attachment_url }} width="160" height="80" />
                <div>{{ message.content }}</div>
              </div>
              <hr>
            </div>
          {% endfor %}
        </div>
      </div>


      <div class="input-group">
        <div>
          <img src="#" alt="" id="q2" width="150" height="150">
        <div>
        <input
          type="text"
          class="form-control"
          id="chatMessageInput"
          placeholder="Enter your chat message"
        />
        <div class="input-group-append">
          <input type="file">
        </div>
        <div class="input-group-append">
          <button class="btn btn-success" id="chatMessageSend" type="button">
            Send
          </button>
        </div>
      </div>
    </div>

    <div>
      <button id="updateMessageBtn">Load messages</button>
    </div>

    <div class="col-12 col-md-4">
      <label for="onlineUsers">Online users</label>
      <select multiple class="form-control" id="onlineUsersSelector"></select>
    </div>
  </div>
  {{ room.name|json_script:"roomName" }}
</div>
<script src="{% static 'room.js' %}"></script>
{% endblock content %}
